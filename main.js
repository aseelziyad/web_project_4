!function(){"use strict";class e{constructor(e){this._popup=document.querySelector(e),this._handleEscapeClose=this._handleEscapeClose.bind(this),this._handleBackgroundClose=this._handleBackgroundClose.bind(this),this._handleCloseOnCloseButtonClick=this._handleCloseOnCloseButtonClick.bind(this),this.closeButton=document.querySelectorAll(".popup__close")}open(){this._popup.classList.add("popup_active"),this._setDocumentEventListeners()}close(){this._popup.classList.remove("popup_active"),this._removeDocumentEventListeners()}_handleEscapeClose(e){"Escape"===e.key&&this.close()}_handleBackgroundClose(e){e.target.classList.contains("popup_active")&&this.close()}_handleCloseOnCloseButtonClick(e){e.target.classList.contains("popup__close")&&this.close()}_setDocumentEventListeners(){document.addEventListener("keydown",this._handleEscapeClose),document.addEventListener("mousedown",this._handleBackgroundClose)}_removeDocumentEventListeners(){document.removeEventListener("keydown",this._handleEscapeClose),document.removeEventListener("mousedown",this._handleBackgroundClose)}setEventListeners(){this._popup.addEventListener("click",this._handleCloseOnCloseButtonClick)}}class t extends e{constructor(e,t,s,n,r){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=this._popup.querySelectorAll(".popup__input"),this._button=this._form.querySelector(".popup__submit-btn"),this._buttonText=n,this._validator=s}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}showLoading(){this._button.textContent="Saving..."}hideLoading(){this._button.textContent="Save"}open(){this._validator.resetValidation(),super.open()}close(){super.close(),this._form.reset()}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(()=>{this._handleFormSubmit(this._getInputValues())}))}}class s{constructor(e,t,s){let{data:n,handleCardClick:r,handleDeleteCard:o,handleLikeIcon:i}=e;var a,l;l=e=>{this._likes=e,this._renderLikes()},(a="updateLike")in this?Object.defineProperty(this,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):this[a]=l,this._cardSelector=t,this._name=n.name,this._link=n.link,this._id=n._id,this._likes=n.likes,this._userId=s,this._ownerId=n.owner._id,this._handleImagePopupOpen=r,this._handleDeleteCard=o,this._handleLikeIcon=i,this._element=this._getCardTemplate(),this._element.querySelector(".photograph__title").textContent=this._name,this._cardImage=this._element.querySelector(".photograph__post"),this._deleteCardButton=this._element.querySelector(".photograph__delete-button"),this._likeCardButton=this._element.querySelector(".photograph__like-button"),this._likeCounter=this._element.querySelector(".photograph__like-counter"),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._setDeleteButton(),this._renderLikes(),this._setEventListeners()}_getCardTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".photograph").cloneNode(!0)}getCard(){return this._element}_setDeleteButton(){this._ownerId!==this._userId&&(this._deleteCardButton.style.display="none")}deleteCard(e){this._element.remove(),this._element=null}checkLikes(){return this._likes.some((e=>e._id==this._userId))}_renderLikes(){this._likeCounter.textContent=this._likes.length,this.checkLikes()?this._likeCardButton.classList.add("photograph__like-button_active"):this._likeCardButton.classList.remove("photograph__like-button_active")}_setEventListeners(){this._deleteCardButton.addEventListener("click",(()=>{this._handleDeleteCard(this._id)})),this._likeCardButton.addEventListener("click",(()=>{this._handleLikeIcon(this._id)})),this._element.querySelector(".photograph__post").addEventListener("click",this._handleImagePopupOpen)}}class n{constructor(e,t){this.formElement=t,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass}_showInputError(e){const t=this.formElement.querySelector("#".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this.formElement.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1)}_setEventListeners(){this._inputElements=[...this.formElement.querySelectorAll(this._inputSelector)],this._buttonElement=this.formElement.querySelector(this._submitButtonSelector),this._toggleButtonState(),this._inputElements.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this.formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}_hasInvalidInput(){return this._inputElements.some((e=>!e.validity.valid))}resetValidation(){this._toggleButtonState(),this._inputElements.forEach((e=>{this._hideInputError(e)}))}}document.querySelector(".popup_edit-profile"),document.querySelector(".popup_avatar");const r=document.querySelector("#input-name"),o=document.querySelector("#input-about"),i=document.querySelector("#form-edit"),a=document.querySelector("#form-avatar"),l=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__avatar-button"),c=document.querySelector(".profile__add-button"),u=(document.querySelector(".profile__title"),document.querySelector(".profile__subtitle"),document.querySelector("#card-template").content,document.querySelector(".photographs"),document.querySelector(".popup_add-card")),d=(u.querySelector("#input-title"),u.querySelector("#input-image-link"),u.querySelector("#form-add")),_={inputSelector:".popup__input",submitButtonSelector:".popup__submit-btn",inactiveButtonClass:"popup__submit-btn_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visiable"},p=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}_getResponseData(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then(this._getResponseData)}getUserInfo(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then(this._getResponseData)}setUserInfo(e){let{name:t,about:s,avatar:n}=e;return fetch("".concat(this._baseUrl,"/users/me "),{headers:this._headers,method:"PATCH",body:JSON.stringify({name:t,about:s,avatar:n})}).then(this._getResponseData)}createCard(e){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers,method:"POST",body:JSON.stringify(e)}).then(this._getResponseData)}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{headers:this._headers,method:"DELETE"}).then(this._getResponseData)}likeCard(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:this._headers,method:"PUT"}).then(this_getResponseData)}disLikeCard(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:this._headers,method:"DELETE"}).then(this._getResponseData)}setUserAvatar(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{headers:this._headers,method:"PATCH",body:JSON.stringify({avatar:e})}).then(this._getResponseData)}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"6edae45a-96e2-41b1-a788-2616fd5c518a","Content-Type":"application/json"}});let m;Promise.all([p.getInitialCards(),p.getUserInfo()]).then((e=>{let[t,s]=e;m=s._id,b.renderer(t),S.setUserInfo({name:s.name,about:s.about}),S.setUserAvatar(s.avatar)})).catch((e=>{console.log(e)}));const v=new class extends e{constructor(e){super(e),this._popupImageCard=this._popup.querySelector(".popup__image-card"),this._popupImageTitle=this._popup.querySelector(".popup__image-title")}openImage(e,t){this._popupImageTitle.textContent=e,this._popupImageCard.src=t,this._popupImageCard.alt=e,super.open()}}(".popup_image");v.setEventListeners();const g=new class extends e{constructor(e){super(e),this._form=this._popup.querySelector(".popup__form")}setAction(e){this._handleSubmit=e}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit()}))}}(".popup_delete");function C(e){let{data:t}=e;const n=new s({data:t,handleCardClick:()=>{v.openImage(t.name,t.link)},handleLikeIcon:e=>{n.checkLikes()?p.disLikeCard(e).then((e=>{n.updateLike(e.likes)})).catch((e=>{console.log(e)})):p.likeCard(e).then((e=>{n.updateLike(e.likes)})).catch((e=>{console.log(e)}))},handleDeleteCard:e=>{g.open(),g.setAction((()=>{p.deleteCard(e).then((e=>{n.deleteCard(),g.close()})).catch((e=>{console.log(e)}))}))}},"#card-template",m);return n.getCard()}g.setEventListeners();const b=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}renderer(e){e.forEach((e=>{this._renderer(e)}))}}({renderer:e=>{b.addItem(C({data:e}))}},".photographs"),E=new n(_,i);E.enableValidation();const S=new class{constructor(e){let{userNameSelector:t,userInfoSelector:s,userAvatarSelector:n}=e;this._name=document.querySelector(t),this._about=document.querySelector(s),this._avatar=document.querySelector(n)}getUserAvatar(){return{avatar:this._avatar.src}}setUserAvatar(e){this._avatar.src=e}getUserInfo(){return{name:this._name.textContent,about:this._about.textContent}}setUserInfo(e){let{name:t,about:s}=e;this._name.textContent=t,this._about.textContent=s}}({userNameSelector:".profile__title",userInfoSelector:".profile__subtitle",userAvatarSelector:".profile__avatar"}),k=new t(".popup_edit-profile",(function(){k.showLoading(),p.setUserInfo(k._getInputValues()).then((e=>{S.setUserInfo(e),k.close()})).catch((e=>{console.log(e)})).finally((()=>{k.hideLoading()}))}),E);k.setEventListeners();const L=new n(_,a);L.enableValidation();const f=new t(".popup_avatar",(function(){const e=f._getInputValues();p.setUserAvatar(e.avatar).then((t=>{S.setUserAvatar(e.avatar),f.close()})).catch((e=>{console.log(e)})).finally((()=>{f.hideLoading()}))}),L);f.setEventListeners();const y=new n(_,d);y.enableValidation();const I=new t(".popup_add-card",(function(e){let{name:t,link:s}=e;const n={name:t,link:s};p.createCard(n).then((e=>{b.addItem(C({data:e})),I.close()})).catch((e=>{console.log(e)})).finally((()=>{I.hideLoading()}))}),y);I.setEventListeners(),l.addEventListener("click",(function(){const{name:e,about:t}=S.getUserInfo();r.value=e,o.value=t,k.open()})),c.addEventListener("click",(function(){I.open()})),h.addEventListener("click",(function(){f.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy91dGlscy9BcGkuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhTdWJtaXQuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHRoaXMuX3BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcbiAgICB0aGlzLl9oYW5kbGVFc2NhcGVDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY2FwZUNsb3NlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5faGFuZGxlQmFja2dyb3VuZENsb3NlID0gdGhpcy5faGFuZGxlQmFja2dyb3VuZENsb3NlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5faGFuZGxlQ2xvc2VPbkNsb3NlQnV0dG9uQ2xpY2sgPSB0aGlzLl9oYW5kbGVDbG9zZU9uQ2xvc2VCdXR0b25DbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMuY2xvc2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19jbG9zZVwiKVxuICB9XG5cbiAgb3BlbigpIHtcbiAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QuYWRkKFwicG9wdXBfYWN0aXZlXCIpO1xuICAgIHRoaXMuX3NldERvY3VtZW50RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9hY3RpdmVcIik7XG4gICAgdGhpcy5fcmVtb3ZlRG9jdW1lbnRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgX2hhbmRsZUVzY2FwZUNsb3NlKGV2ZW50KSB7XG5cblxuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBfaGFuZGxlQmFja2dyb3VuZENsb3NlKGV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9hY3RpdmVcIikpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBfaGFuZGxlQ2xvc2VPbkNsb3NlQnV0dG9uQ2xpY2sgKGV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9fY2xvc2VcIikpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBfc2V0RG9jdW1lbnRFdmVudExpc3RlbmVycygpIHtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NhcGVDbG9zZSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVCYWNrZ3JvdW5kQ2xvc2UpO1xuICB9XG5cbiAgX3JlbW92ZURvY3VtZW50RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjYXBlQ2xvc2UpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5faGFuZGxlQmFja2dyb3VuZENsb3NlKTtcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX3BvcHVwLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9oYW5kbGVDbG9zZU9uQ2xvc2VCdXR0b25DbGljayApO1xuICB9XG59XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcbiBcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQsIHZhbGlkYXRvciwgYnV0dG9uVGV4dCwgbG9hZGluZ0J1dHRvblRleHQpIHtcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcbiAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcbiAgICB0aGlzLl9pbnB1dExpc3QgPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19pbnB1dFwiKTtcbiAgICB0aGlzLl9idXR0b24gPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX3N1Ym1pdC1idG5cIik7XG4gICAgdGhpcy5fYnV0dG9uVGV4dCA9IGJ1dHRvblRleHQ7XG4gICAgLy8gdGhpcy5fbG9hZGluZ0J1dHRvblRleHQgPSBsb2FkaW5nQnV0dG9uVGV4dDtcblxuICAgIHRoaXMuX3ZhbGlkYXRvciA9IHZhbGlkYXRvcjtcbiAgfVxuXG4gIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICBjb25zdCBmb3JtVmFsdWVzID0ge307XG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBmb3JtVmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIGZvcm1WYWx1ZXM7XG4gIH1cblxuICBzaG93TG9hZGluZygpIHtcbiAgICB0aGlzLl9idXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICB9XG4gIFxuICBoaWRlTG9hZGluZygpIHtcbiAgICB0aGlzLl9idXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmVcIjtcbiAgfSBcblxuICBvcGVuKCkge1xuICAgIHRoaXMuX3ZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24oKTtcbiAgICBzdXBlci5vcGVuKCk7XG4gIH1cblxuICBcbiAgY2xvc2UoKSB7XG4gICAgc3VwZXIuY2xvc2UoKTtcbiAgICB0aGlzLl9mb3JtLnJlc2V0KCk7XG5cbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xuICAgIH0pO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcbiAgY29uc3RydWN0b3IoXG4gICAgeyBkYXRhLCBoYW5kbGVDYXJkQ2xpY2ssIGhhbmRsZURlbGV0ZUNhcmQsIGhhbmRsZUxpa2VJY29uIH0sXG4gICAgY2FyZFNlbGVjdG9yLFxuICAgIHVzZXJJZFxuICApIHtcbiAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XG4gICAgdGhpcy5fbmFtZSA9IGRhdGEubmFtZTtcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rO1xuICAgIHRoaXMuX2lkID0gZGF0YS5faWQ7XG4gICAgdGhpcy5fbGlrZXMgPSBkYXRhLmxpa2VzO1xuICAgIHRoaXMuX3VzZXJJZCA9IHVzZXJJZDtcbiAgICB0aGlzLl9vd25lcklkID0gZGF0YS5vd25lci5faWQ7XG4gICAgdGhpcy5faGFuZGxlSW1hZ2VQb3B1cE9wZW4gPSBoYW5kbGVDYXJkQ2xpY2s7XG4gICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZCA9IGhhbmRsZURlbGV0ZUNhcmQ7XG4gICAgdGhpcy5faGFuZGxlTGlrZUljb24gPSBoYW5kbGVMaWtlSWNvbjtcbiAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0Q2FyZFRlbXBsYXRlKCk7XG4gICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBob3RvZ3JhcGhfX3RpdGxlXCIpLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcbiAgICB0aGlzLl9jYXJkSW1hZ2UgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGhvdG9ncmFwaF9fcG9zdFwiKTtcbiAgICB0aGlzLl9kZWxldGVDYXJkQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIucGhvdG9ncmFwaF9fZGVsZXRlLWJ1dHRvblwiXG4gICAgKTtcbiAgICB0aGlzLl9saWtlQ2FyZEJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLnBob3RvZ3JhcGhfX2xpa2UtYnV0dG9uXCJcbiAgICApO1xuICAgIHRoaXMuX2xpa2VDb3VudGVyID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIucGhvdG9ncmFwaF9fbGlrZS1jb3VudGVyXCJcbiAgICApO1xuICAgIHRoaXMuX2NhcmRJbWFnZS5zcmMgPSB0aGlzLl9saW5rO1xuICAgIHRoaXMuX2NhcmRJbWFnZS5hbHQgPSB0aGlzLl9uYW1lO1xuICAgIHRoaXMuX3NldERlbGV0ZUJ1dHRvbigpO1xuICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIF9nZXRDYXJkVGVtcGxhdGUoKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpXG4gICAgICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLnBob3RvZ3JhcGhcIilcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XG4gIH1cblxuICBnZXRDYXJkKCkge1xuICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xuICB9XG4gIC8vdmlzaWJhbGl0eSBvZiBkZWxldGUgaWNvblxuICBfc2V0RGVsZXRlQnV0dG9uKCkge1xuICAgIGlmICh0aGlzLl9vd25lcklkICE9PSB0aGlzLl91c2VySWQpIHtcbiAgICAgIHRoaXMuX2RlbGV0ZUNhcmRCdXR0b24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIH1cbiAgfVxuXG4gIGRlbGV0ZUNhcmQoX2lkKSB7XG4gICAgdGhpcy5fZWxlbWVudC5yZW1vdmUoKTtcbiAgICB0aGlzLl9lbGVtZW50ID0gbnVsbDtcbiAgfVxuXG4gIGNoZWNrTGlrZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xpa2VzLnNvbWUoKHBlcnNvbikgPT4gcGVyc29uLl9pZCA9PSB0aGlzLl91c2VySWQpO1xuICB9XG5cbiAgdXBkYXRlTGlrZSA9IChuZXdMaWtlcykgPT4ge1xuICAgIHRoaXMuX2xpa2VzID0gbmV3TGlrZXM7XG4gICAgdGhpcy5fcmVuZGVyTGlrZXMoKTtcbiAgfTtcblxuICBfcmVuZGVyTGlrZXMoKSB7XG4gICAgdGhpcy5fbGlrZUNvdW50ZXIudGV4dENvbnRlbnQgPSB0aGlzLl9saWtlcy5sZW5ndGg7XG4gICAgaWYgKHRoaXMuY2hlY2tMaWtlcygpKSB7XG4gICAgICB0aGlzLl9saWtlQ2FyZEJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwicGhvdG9ncmFwaF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9saWtlQ2FyZEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwicGhvdG9ncmFwaF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgIH1cbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9kZWxldGVDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVEZWxldGVDYXJkKHRoaXMuX2lkKTtcbiAgICB9KTtcbiAgICB0aGlzLl9saWtlQ2FyZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlTGlrZUljb24odGhpcy5faWQpO1xuICAgIH0pO1xuICAgIHRoaXMuX2VsZW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLnBob3RvZ3JhcGhfX3Bvc3RcIilcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5faGFuZGxlSW1hZ2VQb3B1cE9wZW4pO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbGVtZW50KSB7XG4gICAgdGhpcy5mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xuXG4gICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IHNldHRpbmdzLmlucHV0U2VsZWN0b3I7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvcjtcbiAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcztcbiAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBzZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3M7XG4gICAgdGhpcy5fZXJyb3JDbGFzcyA9IHNldHRpbmdzLmVycm9yQ2xhc3M7XG4gIH1cblxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICAgKTtcblxuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxuICAgICk7XG5cbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XG4gIH1cblxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCkge1xuICAgIGlmIChpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XG4gICAgfVxuICB9XG5cbiAgX3RvZ2dsZUJ1dHRvblN0YXRlKCkge1xuICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoKSkge1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5faW5wdXRFbGVtZW50cyA9IFtcbiAgICAgIC4uLnRoaXMuZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKSxcbiAgICBdO1xuICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQgPSB0aGlzLmZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvclxuICAgICk7XG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcblxuICAgIHRoaXMuX2lucHV0RWxlbWVudHMuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldmVudCkgPT4ge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgX2hhc0ludmFsaWRJbnB1dCgpIHtcbiAgICByZXR1cm4gdGhpcy5faW5wdXRFbGVtZW50cy5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xuICAgIH0pO1xuICB9XG5cbiAgcmVzZXRWYWxpZGF0aW9uKCkge1xuICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgdGhpcy5faW5wdXRFbGVtZW50cy5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XG4gICAgfSk7XG4gIH1cbn1cbiIsImV4cG9ydCBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4gIHtcbiAgICBuYW1lOiBcIllvc2VtaXRlIFZhbGxleVwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUveW9zZW1pdGUuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkxha2UgTG91aXNlXCIsXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWtlLWxvdWlzZS5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQmFsZCBNb3VudGFpbnNcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2JhbGQtbW91bnRhaW5zLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJMYXRlbWFyXCIsXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYXRlbWFyLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3Zhbm9pc2UuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkxhZ28gZGkgQnJhaWVzXCIsXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWdvLmpwZ1wiLFxuICB9LFxuXTtcblxuZXhwb3J0IGNvbnN0IHBvcHVwRWRpdFByb2ZpbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX2VkaXQtcHJvZmlsZVwiKTtcbmV4cG9ydCBjb25zdCBwb3B1cEF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfYXZhdGFyXCIpO1xuZXhwb3J0IGNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXQtbmFtZVwiKTtcbmV4cG9ydCBjb25zdCBhYm91dElucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNpbnB1dC1hYm91dFwiKTtcbmV4cG9ydCBjb25zdCBlZGl0Rm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZm9ybS1lZGl0XCIpO1xuZXhwb3J0IGNvbnN0IGF2YXRhckZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2Zvcm0tYXZhdGFyXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIucHJvZmlsZV9fZWRpdC1idXR0b25cIlxuKTtcbmV4cG9ydCBjb25zdCBhdmF0YXJFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIucHJvZmlsZV9fYXZhdGFyLWJ1dHRvblwiXG4pO1xuXG5leHBvcnQgY29uc3QgcHJvZmlsZUFkZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX3RpdGxlXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVTdWJ0aXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fc3VidGl0bGVcIik7XG5cbmV4cG9ydCBjb25zdCBwb3B1cEltYWdlQ2xhc3MgPSBcIi5wb3B1cF9pbWFnZVwiO1xuZXhwb3J0IGNvbnN0IHBvcHVwRGVsZXRlID0gXCIucG9wdXBfZGVsZXRlXCI7XG5cbmV4cG9ydCBjb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIikuY29udGVudDtcbmV4cG9ydCBjb25zdCBjYXJkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGhvdG9ncmFwaHNcIik7XG5leHBvcnQgY29uc3QgcG9wdXBBZGRDYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9hZGQtY2FyZFwiKTtcbmV4cG9ydCBjb25zdCB0aXRsZUlucHV0ID0gcG9wdXBBZGRDYXJkLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXQtdGl0bGVcIik7XG5leHBvcnQgY29uc3QgaW1hZ2VMaW5rSW5wdXQgPSBwb3B1cEFkZENhcmQucXVlcnlTZWxlY3RvcihcIiNpbnB1dC1pbWFnZS1saW5rXCIpO1xuZXhwb3J0IGNvbnN0IGFkZEZvcm0gPSBwb3B1cEFkZENhcmQucXVlcnlTZWxlY3RvcihcIiNmb3JtLWFkZFwiKTtcbi8vX19fX19fX19fX19fX19fX19fX19fX3RlbXBsYXRlLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0vL1xuZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xuICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLnBvcHVwX19zdWJtaXQtYnRuXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwicG9wdXBfX3N1Ym1pdC1idG5fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwicG9wdXBfX2Vycm9yX3Zpc2lhYmxlXCIsXG59O1xuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCBQb3B1cCBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cC5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aFN1Ym1pdCBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhTdWJtaXQuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcbmltcG9ydCB7XG4gIHNldHRpbmdzLFxuICBwcm9maWxlRWRpdEJ1dHRvbixcbiAgcHJvZmlsZUFkZEJ1dHRvbixcbiAgYXZhdGFyRWRpdEJ1dHRvbixcbiAgZWRpdEZvcm0sXG4gIGF2YXRhckZvcm0sXG4gIGFkZEZvcm0sXG4gIG5hbWVJbnB1dCxcbiAgYWJvdXRJbnB1dCxcbiAgcG9wdXBJbWFnZUNsYXNzLFxuICBwb3B1cERlbGV0ZSxcbn0gZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50cy5qc1wiO1xuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMlwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCI2ZWRhZTQ1YS05NmUyLTQxYjEtYTc4OC0yNjE2ZmQ1YzUxOGFcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG5sZXQgdXNlcklkXG5cblxuUHJvbWlzZS5hbGwoW2FwaS5nZXRJbml0aWFsQ2FyZHMoKSwgYXBpLmdldFVzZXJJbmZvKCldKVxuICAudGhlbigoW2NhcmRzRGF0YSwgdXNlckRhdGFdKSA9PiB7XG4gICAgdXNlcklkID0gdXNlckRhdGEuX2lkO1xuICAgIGNhcmRMaXN0LnJlbmRlcmVyKGNhcmRzRGF0YSk7XG4gICAgdXNlckluZm8uc2V0VXNlckluZm8oe1xuICAgICAgbmFtZTogdXNlckRhdGEubmFtZSxcbiAgICAgIGFib3V0OiB1c2VyRGF0YS5hYm91dCxcbiAgICB9KVxuICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIodXNlckRhdGEuYXZhdGFyKVxuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGVycik7XG4gIH0pO1xuLy8tLS0tLS0tLSBjcmVhdGUgY2FyZHNcblxuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShwb3B1cEltYWdlQ2xhc3MpO1xuaW1hZ2VQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBkZWxldGVDYXJkUG9wdXAgPSBuZXcgUG9wdXBXaXRoU3VibWl0KHBvcHVwRGVsZXRlKTtcbmRlbGV0ZUNhcmRQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5mdW5jdGlvbiBjcmVhdGVDYXJkKHsgZGF0YSB9KSB7XG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcbiAgICB7XG4gICAgICBkYXRhLFxuICAgICAgaGFuZGxlQ2FyZENsaWNrOiAoKSA9PiB7XG4gICAgICAgIGltYWdlUG9wdXAub3BlbkltYWdlKGRhdGEubmFtZSwgZGF0YS5saW5rKTtcbiAgICAgIH0sXG4gICAgICBoYW5kbGVMaWtlSWNvbjogKGlkKSA9PiB7XG4gICAgICAgIGNvbnN0IGlzTGlrZWQgPSBjYXJkLmNoZWNrTGlrZXMoKTtcbiAgICAgICAgaWYgKGlzTGlrZWQpIHtcbiAgICAgICAgICBhcGlcbiAgICAgICAgICAuZGlzTGlrZUNhcmQoaWQpXG4gICAgICAgICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICAgICAgICBjYXJkLnVwZGF0ZUxpa2UocmVzLmxpa2VzKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXBpXG4gICAgICAgICAgLmxpa2VDYXJkKGlkKVxuICAgICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgIGNhcmQudXBkYXRlTGlrZShyZXMubGlrZXMpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG5cbiAgICAgIGhhbmRsZURlbGV0ZUNhcmQ6IChpZCkgPT4ge1xuICAgICAgICAgIGRlbGV0ZUNhcmRQb3B1cC5vcGVuKCk7XG4gICAgICBcbiAgICAgICAgZGVsZXRlQ2FyZFBvcHVwLnNldEFjdGlvbigoKSA9PiB7XG4gICAgICAgICAgYXBpXG4gICAgICAgICAgICAuZGVsZXRlQ2FyZChpZClcbiAgICAgICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICAgICAgY2FyZC5kZWxldGVDYXJkKCk7XG4gICAgICAgICAgICBkZWxldGVDYXJkUG9wdXAuY2xvc2UoKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgfSxcbiAgICB9LFxuICAgIFwiI2NhcmQtdGVtcGxhdGVcIixcbiAgICB1c2VySWRcbiAgKTtcbiAgLy90aGlzLl9lbGVtZW50XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZC5nZXRDYXJkKCk7XG4gIHJldHVybiBjYXJkRWxlbWVudDtcbn1cblxuY29uc3QgY2FyZExpc3QgPSBuZXcgU2VjdGlvbihcbiAge1xuICAgIHJlbmRlcmVyOiAoZGF0YSkgPT4ge1xuICAgICAgY2FyZExpc3QuYWRkSXRlbShjcmVhdGVDYXJkKHsgZGF0YSB9KSk7XG4gICAgfSxcbiAgfSxcbiAgXCIucGhvdG9ncmFwaHNcIlxuKTtcblxuLy8gLS0tLS0tIFByb2ZpbGVcbmNvbnN0IGVkaXRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3Ioc2V0dGluZ3MsIGVkaXRGb3JtKTtcbmVkaXRGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xuICB1c2VyTmFtZVNlbGVjdG9yOiBcIi5wcm9maWxlX190aXRsZVwiLFxuICB1c2VySW5mb1NlbGVjdG9yOiBcIi5wcm9maWxlX19zdWJ0aXRsZVwiLFxuICB1c2VyQXZhdGFyU2VsZWN0b3I6IFwiLnByb2ZpbGVfX2F2YXRhclwiLFxufSk7XG5cbmNvbnN0IGVkaXRQcm9maWxlUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcbiAgXCIucG9wdXBfZWRpdC1wcm9maWxlXCIsXG4gIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0LFxuICBlZGl0Rm9ybVZhbGlkYXRvclxuKTtcbmVkaXRQcm9maWxlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuLy8gZnVuY3Rpb24gaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQoZGF0YSkge1xuLy8gICBlZGl0UHJvZmlsZVBvcHVwLnNob3dMb2FkaW5nKCk7XG4vLyAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKGRhdGEpO1xuLy8gICBlZGl0UHJvZmlsZVBvcHVwLmNsb3NlKCk7XG4vLyB9XG5cbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KCkge1xuICBlZGl0UHJvZmlsZVBvcHVwLnNob3dMb2FkaW5nKCk7XG4gIGFwaVxuICAuc2V0VXNlckluZm8oZWRpdFByb2ZpbGVQb3B1cC5fZ2V0SW5wdXRWYWx1ZXMoKSlcbiAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyhkYXRhKTtcbiAgICBlZGl0UHJvZmlsZVBvcHVwLmNsb3NlKCk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTtcbiAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBlZGl0UHJvZmlsZVBvcHVwLmhpZGVMb2FkaW5nKCk7XG4gIH0pXG59XG5cbmZ1bmN0aW9uIGhhbmRsZUVkaXRCdXR0b24oKSB7XG4gIGNvbnN0IHsgbmFtZSwgYWJvdXQgfSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIG5hbWVJbnB1dC52YWx1ZSA9IG5hbWU7XG4gIGFib3V0SW5wdXQudmFsdWUgPSBhYm91dDtcbiAgZWRpdFByb2ZpbGVQb3B1cC5vcGVuKCk7XG59XG4vLyBfX19fX19fX0F2YXRhclxuXG5jb25zdCBhdmF0YXJGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3Ioc2V0dGluZ3MsIGF2YXRhckZvcm0pO1xuYXZhdGFyRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmNvbnN0IGVkaXRBdmF0YXJQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFxuICBcIi5wb3B1cF9hdmF0YXJcIixcbiAgaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdCxcbiAgYXZhdGFyRm9ybVZhbGlkYXRvcixcbik7XG5lZGl0QXZhdGFyUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdCgpIHtcbiAgY29uc3QgZGF0YSA9IGVkaXRBdmF0YXJQb3B1cC5fZ2V0SW5wdXRWYWx1ZXMoKTtcbiAgYXBpXG4gICAgLnNldFVzZXJBdmF0YXIoZGF0YS5hdmF0YXIpXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgdXNlckluZm8uc2V0VXNlckF2YXRhcihkYXRhLmF2YXRhcik7XG4gICAgICBlZGl0QXZhdGFyUG9wdXAuY2xvc2UoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgZWRpdEF2YXRhclBvcHVwLmhpZGVMb2FkaW5nKCk7XG4gIH0pXG59XG5cbmZ1bmN0aW9uIGhhbmRsZUF2YXRhckJ1dHRvbigpIHtcbiAgZWRpdEF2YXRhclBvcHVwLm9wZW4oKTtcbn1cblxuLy8gLS0tLS0tLS0tQWRkIENhcmRcblxuY29uc3QgYWRkRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHNldHRpbmdzLCBhZGRGb3JtKTtcbmFkZEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBhZGRDYXJkUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcbiAgXCIucG9wdXBfYWRkLWNhcmRcIixcbiAgaGFuZGxlQ2FyZEZvcm1TdWJtaXQsXG4gIGFkZEZvcm1WYWxpZGF0b3IsXG4pO1xuYWRkQ2FyZFBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmZ1bmN0aW9uIGhhbmRsZUNhcmRGb3JtU3VibWl0KHsgbmFtZSwgbGluayB9KSB7XG4gIGNvbnN0IGRhdGEgPSB7XG4gICAgbmFtZTogbmFtZSxcbiAgICBsaW5rOiBsaW5rLFxuICB9O1xuICBhcGlcbiAgICAuY3JlYXRlQ2FyZChkYXRhKVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBjYXJkTGlzdC5hZGRJdGVtKGNyZWF0ZUNhcmQoeyBkYXRhIH0pKTtcbiAgICAgIGFkZENhcmRQb3B1cC5jbG9zZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgfSlcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgYWRkQ2FyZFBvcHVwLmhpZGVMb2FkaW5nKCk7XG4gICAgfSlcbn1cblxuZnVuY3Rpb24gaGFuZGxlQWRkQnV0dG9uKCkge1xuICBhZGRDYXJkUG9wdXAub3BlbigpO1xufVxuXG4vLyAtLS0tLS0tLS0tLS0tIGV2ZW50TGlzdGVuZXJzXG5wcm9maWxlRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlRWRpdEJ1dHRvbik7XG5wcm9maWxlQWRkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVBZGRCdXR0b24pO1xuYXZhdGFyRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlQXZhdGFyQnV0dG9uKTsiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xuICB9XG5cbiAgX2dldFJlc3BvbnNlRGF0YShyZXMpIHtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7IFxuICAgIH1cbiAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgfVxuICBcbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSlcbiAgICAgIC50aGVuKHRoaXMuX2dldFJlc3BvbnNlRGF0YSk7XG4gIH1cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KVxuICAgICAgLnRoZW4odGhpcy5fZ2V0UmVzcG9uc2VEYXRhKTtcbiAgfVxuXG4gIHNldFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQsIGF2YXRhciB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lIGAse1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGFib3V0LFxuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KVxuICAgICAgLnRoZW4odGhpcy5fZ2V0UmVzcG9uc2VEYXRhKTtcbiAgfVxuXG4gIGNyZWF0ZUNhcmQoZGF0YSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgfSlcbiAgICAgIC50aGVuKHRoaXMuX2dldFJlc3BvbnNlRGF0YSk7XG4gIH1cblxuICAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICB9KVxuICAgIC50aGVuKHRoaXMuX2dldFJlc3BvbnNlRGF0YSk7XG4gICB9XG4gIFxuICAgbGlrZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtpZH1gLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgIH0pXG4gICAgLnRoZW4odGhpc19nZXRSZXNwb25zZURhdGEpO1xuICAgfVxuICBcbiAgZGlzTGlrZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtpZH1gLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgIH0pXG4gICAgLnRoZW4odGhpcy5fZ2V0UmVzcG9uc2VEYXRhKTtcbiAgfVxuXG4gIHNldFVzZXJBdmF0YXIoaW1hZ2VMaW5rKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5XG4gICAgICAgICh7IGF2YXRhcjogaW1hZ2VMaW5rIH0pLFxuICAgIH0pXG4gICAgLnRoZW4odGhpcy5fZ2V0UmVzcG9uc2VEYXRhKTtcbiAgfVxufVxuXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICB0aGlzLl9wb3B1cEltYWdlQ2FyZCA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2ltYWdlLWNhcmRcIik7XG4gICAgdGhpcy5fcG9wdXBJbWFnZVRpdGxlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1hZ2UtdGl0bGVcIik7XG4gIH1cblxuICBvcGVuSW1hZ2UobmFtZSwgbGluaykge1xuICAgIHRoaXMuX3BvcHVwSW1hZ2VUaXRsZS50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgdGhpcy5fcG9wdXBJbWFnZUNhcmQuc3JjID0gbGluaztcbiAgICB0aGlzLl9wb3B1cEltYWdlQ2FyZC5hbHQgPSBuYW1lO1xuXG4gICAgc3VwZXIub3BlbigpO1xuICB9XG59XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoU3VibWl0IGV4dGVuZHMgUG9wdXAge1xuICAgIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgICAgIHRoaXMuX2Zvcm0gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xuICAgIH1cblxuICAgIHNldEFjdGlvbihhY3Rpb24pIHtcbiAgICAgICAgdGhpcy5faGFuZGxlU3VibWl0ID0gYWN0aW9uO1xuICAgIH1cblxuXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgICAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgICAgICB0aGlzLl9wb3B1cC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVTdWJtaXQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICB9XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcbiAgY29uc3RydWN0b3IoeyByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgIC8vIHRoaXMuX2l0ZW1zID0gaXRlbXM7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgfVxuXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xuICB9XG5cbiAgcmVuZGVyZXIoaXRlbXMpIHtcbiAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xuICBjb25zdHJ1Y3Rvcih7IHVzZXJOYW1lU2VsZWN0b3IsIHVzZXJJbmZvU2VsZWN0b3IsIHVzZXJBdmF0YXJTZWxlY3RvciB9KSB7XG4gICAgdGhpcy5fbmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodXNlck5hbWVTZWxlY3Rvcik7XG4gICAgdGhpcy5fYWJvdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJJbmZvU2VsZWN0b3IpO1xuICAgIHRoaXMuX2F2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodXNlckF2YXRhclNlbGVjdG9yKTtcbiAgfVxuXG4gIGdldFVzZXJBdmF0YXIoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGF2YXRhcjogdGhpcy5fYXZhdGFyLnNyY1xuICAgIH07XG4gIH1cblxuICBzZXRVc2VyQXZhdGFyKGltYWdlTGluaykge1xuICAgIHRoaXMuX2F2YXRhci5zcmMgPSBpbWFnZUxpbms7XG4gIH1cbiAgLy8gIC0tICByZXR1cm5zIGFuIG9iamVjdCB3aXRoIGluZm9ybWF0aW9uIGFib3V0IHRoZSB1c2VyLlxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogdGhpcy5fbmFtZS50ZXh0Q29udGVudCxcbiAgICAgIGFib3V0OiB0aGlzLl9hYm91dC50ZXh0Q29udGVudCxcbiAgICB9O1xuICB9XG5cbiAgLy8gIC0tLS0tdGFrZXMgbmV3IHVzZXIgZGF0YSBhbmQgYWRkcyBpdCBvbiB0aGUgcGFnZVxuICBzZXRVc2VySW5mbyh7bmFtZSwgYWJvdXR9KSB7XG4gICAgdGhpcy5fbmFtZS50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgdGhpcy5fYWJvdXQudGV4dENvbnRlbnQgPSBhYm91dDtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIlBvcHVwIiwiY29uc3RydWN0b3IiLCJwb3B1cFNlbGVjdG9yIiwidGhpcyIsIl9wb3B1cCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIl9oYW5kbGVFc2NhcGVDbG9zZSIsImJpbmQiLCJfaGFuZGxlQmFja2dyb3VuZENsb3NlIiwiX2hhbmRsZUNsb3NlT25DbG9zZUJ1dHRvbkNsaWNrIiwiY2xvc2VCdXR0b24iLCJxdWVyeVNlbGVjdG9yQWxsIiwib3BlbiIsImNsYXNzTGlzdCIsImFkZCIsIl9zZXREb2N1bWVudEV2ZW50TGlzdGVuZXJzIiwiY2xvc2UiLCJyZW1vdmUiLCJfcmVtb3ZlRG9jdW1lbnRFdmVudExpc3RlbmVycyIsImV2ZW50Iiwia2V5IiwidGFyZ2V0IiwiY29udGFpbnMiLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInNldEV2ZW50TGlzdGVuZXJzIiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZUZvcm1TdWJtaXQiLCJ2YWxpZGF0b3IiLCJidXR0b25UZXh0IiwibG9hZGluZ0J1dHRvblRleHQiLCJzdXBlciIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2Zvcm0iLCJfaW5wdXRMaXN0IiwiX2J1dHRvbiIsIl9idXR0b25UZXh0IiwiX3ZhbGlkYXRvciIsIl9nZXRJbnB1dFZhbHVlcyIsImZvcm1WYWx1ZXMiLCJmb3JFYWNoIiwiaW5wdXQiLCJuYW1lIiwidmFsdWUiLCJzaG93TG9hZGluZyIsInRleHRDb250ZW50IiwiaGlkZUxvYWRpbmciLCJyZXNldFZhbGlkYXRpb24iLCJyZXNldCIsIkNhcmQiLCJjYXJkU2VsZWN0b3IiLCJ1c2VySWQiLCJkYXRhIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlRGVsZXRlQ2FyZCIsImhhbmRsZUxpa2VJY29uIiwibmV3TGlrZXMiLCJfbGlrZXMiLCJfcmVuZGVyTGlrZXMiLCJfY2FyZFNlbGVjdG9yIiwiX25hbWUiLCJfbGluayIsImxpbmsiLCJfaWQiLCJsaWtlcyIsIl91c2VySWQiLCJfb3duZXJJZCIsIm93bmVyIiwiX2hhbmRsZUltYWdlUG9wdXBPcGVuIiwiX2hhbmRsZURlbGV0ZUNhcmQiLCJfaGFuZGxlTGlrZUljb24iLCJfZWxlbWVudCIsIl9nZXRDYXJkVGVtcGxhdGUiLCJfY2FyZEltYWdlIiwiX2RlbGV0ZUNhcmRCdXR0b24iLCJfbGlrZUNhcmRCdXR0b24iLCJfbGlrZUNvdW50ZXIiLCJzcmMiLCJhbHQiLCJfc2V0RGVsZXRlQnV0dG9uIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiY29udGVudCIsImNsb25lTm9kZSIsImdldENhcmQiLCJzdHlsZSIsImRpc3BsYXkiLCJkZWxldGVDYXJkIiwiY2hlY2tMaWtlcyIsInNvbWUiLCJwZXJzb24iLCJsZW5ndGgiLCJGb3JtVmFsaWRhdG9yIiwic2V0dGluZ3MiLCJmb3JtRWxlbWVudCIsIl9pbnB1dFNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsIl9zdWJtaXRCdXR0b25TZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX2lucHV0RXJyb3JDbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsIl9lcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIl9zaG93SW5wdXRFcnJvciIsImlucHV0RWxlbWVudCIsImVycm9yRWxlbWVudCIsImlkIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaGlkZUlucHV0RXJyb3IiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl90b2dnbGVCdXR0b25TdGF0ZSIsIl9oYXNJbnZhbGlkSW5wdXQiLCJfYnV0dG9uRWxlbWVudCIsImRpc2FibGVkIiwiX2lucHV0RWxlbWVudHMiLCJlbmFibGVWYWxpZGF0aW9uIiwicHJldmVudERlZmF1bHQiLCJuYW1lSW5wdXQiLCJhYm91dElucHV0IiwiZWRpdEZvcm0iLCJhdmF0YXJGb3JtIiwicHJvZmlsZUVkaXRCdXR0b24iLCJhdmF0YXJFZGl0QnV0dG9uIiwicHJvZmlsZUFkZEJ1dHRvbiIsInBvcHVwQWRkQ2FyZCIsImFkZEZvcm0iLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfZ2V0UmVzcG9uc2VEYXRhIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldEluaXRpYWxDYXJkcyIsImZldGNoIiwidGhlbiIsImdldFVzZXJJbmZvIiwic2V0VXNlckluZm8iLCJhYm91dCIsImF2YXRhciIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiY3JlYXRlQ2FyZCIsImNhcmRJZCIsImxpa2VDYXJkIiwidGhpc19nZXRSZXNwb25zZURhdGEiLCJkaXNMaWtlQ2FyZCIsInNldFVzZXJBdmF0YXIiLCJpbWFnZUxpbmsiLCJhdXRob3JpemF0aW9uIiwiYWxsIiwiY2FyZHNEYXRhIiwidXNlckRhdGEiLCJjYXJkTGlzdCIsInJlbmRlcmVyIiwidXNlckluZm8iLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJpbWFnZVBvcHVwIiwiX3BvcHVwSW1hZ2VDYXJkIiwiX3BvcHVwSW1hZ2VUaXRsZSIsIm9wZW5JbWFnZSIsImRlbGV0ZUNhcmRQb3B1cCIsInNldEFjdGlvbiIsImFjdGlvbiIsIl9oYW5kbGVTdWJtaXQiLCJldnQiLCJjYXJkIiwidXBkYXRlTGlrZSIsImNvbnRhaW5lclNlbGVjdG9yIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsImFkZEl0ZW0iLCJlbGVtZW50IiwicHJlcGVuZCIsIml0ZW1zIiwiaXRlbSIsImVkaXRGb3JtVmFsaWRhdG9yIiwidXNlck5hbWVTZWxlY3RvciIsInVzZXJJbmZvU2VsZWN0b3IiLCJ1c2VyQXZhdGFyU2VsZWN0b3IiLCJfYWJvdXQiLCJfYXZhdGFyIiwiZ2V0VXNlckF2YXRhciIsImVkaXRQcm9maWxlUG9wdXAiLCJmaW5hbGx5IiwiYXZhdGFyRm9ybVZhbGlkYXRvciIsImVkaXRBdmF0YXJQb3B1cCIsImFkZEZvcm1WYWxpZGF0b3IiLCJhZGRDYXJkUG9wdXAiXSwic291cmNlUm9vdCI6IiJ9